<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Admin - Lovable Infinity</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        /* Tema escuro – layout full-width; contraste garantido para leitura tranquila */
        body.admin-page { width: 100%; min-height: 100vh; height: 100vh; background: #0f172a; color: #f1f5f9; margin: 0; box-sizing: border-box; display: flex; flex-direction: column; overflow: hidden; }
        body.admin-page::before { display: none; }
        .admin-topbar { width: 100%; height: 64px; padding: 0 40px; box-sizing: border-box; display: flex; align-items: center; justify-content: space-between; background: #1e293b; border-bottom: 1px solid #334155; flex-shrink: 0; }
        .admin-topbar h1 { font-size: 20px; font-weight: 600; margin: 0; color: #f1f5f9; letter-spacing: -0.02em; }
        .admin-topbar-desc { color: #94a3b8; font-size: 13px; font-weight: 400; margin: 2px 0 0 0; }
        .admin-topbar .btn-cta { padding: 10px 24px; font-size: 14px; font-weight: 600; background: #6366f1; color: #fff; border: none; border-radius: 8px; cursor: pointer; transition: background 0.2s, box-shadow 0.2s; }
        .admin-topbar .btn-cta:hover { background: #4f46e5; box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.4); }
        .admin-main { width: 100%; max-width: 1600px; margin: 0 auto; padding: 32px 40px 48px; box-sizing: border-box; }
        .section { background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 28px 32px; margin-bottom: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
        .section h2 { font-size: 15px; font-weight: 600; margin-bottom: 20px; color: #f1f5f9; letter-spacing: -0.01em; line-height: 1.4; }
        .form-group { margin-bottom: 18px; }
        .form-group label { display: block; font-size: 12px; font-weight: 500; color: #94a3b8; margin-bottom: 6px; text-transform: none; letter-spacing: 0; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px 14px; background: #0f172a; border: 1px solid #475569; border-radius: 8px; color: #f1f5f9; font-family: inherit; font-size: 14px; box-sizing: border-box; transition: border-color 0.15s, box-shadow 0.15s; }
        .form-group input::placeholder, .form-group textarea::placeholder { color: #64748b; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { border-color: #6366f1; outline: none; box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2); }
        .checkbox-label { display: flex; align-items: center; gap: 10px; cursor: pointer; text-transform: none; font-weight: 500; font-size: 14px; color: #e2e8f0; }
        .checkbox-label input { width: auto; accent-color: #6366f1; }
        .button-group { display: flex; gap: 10px; margin-top: 22px; flex-wrap: wrap; }
        .btn { padding: 10px 20px; border: none; border-radius: 8px; font-weight: 500; cursor: pointer; transition: all 0.2s; font-size: 14px; }
        .btn-primary { background: #6366f1; color: #fff; }
        .btn-primary:hover { background: #4f46e5; box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.4); }
        .btn-secondary { background: #1e293b; color: #e2e8f0; border: 1px solid #475569; }
        .btn-secondary:hover { background: #334155; border-color: #64748b; color: #f1f5f9; }
        .btn-danger { background: rgba(239, 68, 68, 0.15); color: #fca5a5; border: 1px solid rgba(239, 68, 68, 0.4); }
        .btn-danger:hover { background: rgba(239, 68, 68, 0.25); border-color: #f87171; color: #fecaca; }
        .stats-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 24px; margin-bottom: 32px; }
        .stat-card { background: #1e293b; border: 1px solid #334155; border-radius: 10px; padding: 24px; text-align: center; box-shadow: 0 1px 2px rgba(0,0,0,0.2); transition: box-shadow 0.2s, border-color 0.2s; }
        .stat-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.25); border-color: #475569; }
        .stat-number { font-size: 28px; font-weight: 600; color: #f1f5f9; margin-bottom: 8px; letter-spacing: -0.02em; }
        .stat-label { font-size: 12px; color: #94a3b8; font-weight: 500; text-transform: none; letter-spacing: 0; }
        .license-table { width: 100%; border-collapse: collapse; margin-top: 0; font-size: 13px; }
        .license-table th { background: #0f172a; padding: 12px 16px; text-align: left; font-weight: 500; color: #94a3b8; border-bottom: 1px solid #334155; font-size: 11px; text-transform: none; letter-spacing: 0.02em; }
        .license-table td { padding: 14px 16px; border-bottom: 1px solid #334155; color: #e2e8f0; }
        .license-table tbody tr:hover { background: rgba(51, 65, 85, 0.4); }
        .license-table tbody tr:last-child td { border-bottom: none; }
        .status-badge-small { display: inline-block; padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 500; text-transform: none; }
        .status-active { background: rgba(52, 211, 153, 0.2); color: #6ee7b7; border: 1px solid rgba(52, 211, 153, 0.4); }
        .status-inactive { background: rgba(239, 68, 68, 0.2); color: #fca5a5; border: 1px solid rgba(239, 68, 68, 0.4); }
        .status-expiring { background: rgba(251, 191, 36, 0.2); color: #fcd34d; border: 1px solid rgba(251, 191, 36, 0.4); }
        .license-key { font-family: ui-monospace, monospace; background: #0f172a; color: #94a3b8; padding: 6px 10px; border-radius: 6px; font-size: 11px; word-break: break-all; user-select: all; border: 1px solid #334155; }
        .action-buttons { display: flex; gap: 6px; flex-wrap: wrap; }
        .action-btn-small { padding: 6px 12px; font-size: 12px; background: #1e293b; border: 1px solid #475569; color: #e2e8f0; border-radius: 6px; cursor: pointer; transition: all 0.15s; font-weight: 500; }
        .action-btn-small:hover { background: #334155; color: #f1f5f9; border-color: #64748b; }
        .action-btn-small.delete { background: rgba(239, 68, 68, 0.15); color: #fca5a5; border-color: rgba(239, 68, 68, 0.4); }
        .action-btn-small.delete:hover { background: rgba(239, 68, 68, 0.25); color: #fecaca; border-color: #f87171; }
        .alert { padding: 12px 16px; border-radius: 8px; margin-bottom: 16px; display: none; font-size: 14px; }
        .alert.show { display: block; }
        .alert-success { background: rgba(52, 211, 153, 0.15); color: #6ee7b7; border: 1px solid rgba(52, 211, 153, 0.4); }
        .alert-error { background: rgba(239, 68, 68, 0.15); color: #fca5a5; border: 1px solid rgba(239, 68, 68, 0.4); }
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(6px); z-index: 9999; align-items: center; justify-content: center; padding: 24px; box-sizing: border-box; }
        .modal.show { display: flex; }
        .modal-content { background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 28px; max-width: 440px; width: 100%; max-height: 90vh; overflow-y: auto; position: relative; box-shadow: 0 20px 40px rgba(0,0,0,0.4); }
        .modal-content.modal-edit { max-width: 500px; }
        .modal-header { font-size: 18px; font-weight: 600; color: #f1f5f9; margin-bottom: 20px; padding-right: 32px; letter-spacing: -0.01em; }
        .modal-close { position: absolute; top: 16px; right: 16px; background: transparent; border: none; color: #94a3b8; font-size: 20px; cursor: pointer; line-height: 1; padding: 8px; min-width: 44px; min-height: 44px; display: flex; align-items: center; justify-content: center; border-radius: 8px; }
        .modal-close:hover { color: #f1f5f9; background: rgba(255,255,255,0.06); }
        .import-export-toggle { margin-bottom: 0; }
        .import-export-body { display: none; padding-top: 20px; margin-top: 20px; border-top: 1px solid #334155; }
        .import-export-body.show { display: block; }
        .copy-toast { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%) translateY(8px); padding: 10px 20px; background: #1e293b; color: #f1f5f9; font-weight: 500; font-size: 13px; border-radius: 8px; border: 1px solid #475569; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 10001; opacity: 0; pointer-events: none; transition: opacity 0.25s ease, transform 0.25s ease; }
        .copy-toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
        .modal-content #modal-message { color: #94a3b8; margin-bottom: 20px; line-height: 1.5; }
        .admin-table-wrap { overflow-x: auto; -webkit-overflow-scrolling: touch; margin: 0 -2px 0 0; border-radius: 8px; }
        .license-table { min-width: 720px; }
        @media (max-width: 768px) {
            .admin-topbar { padding: 0 24px; flex-wrap: wrap; height: auto; min-height: 64px; padding-top: 12px; padding-bottom: 12px; gap: 8px; }
            .admin-topbar h1 { font-size: 18px; }
            .admin-topbar-desc { font-size: 12px; }
            .admin-main { padding: 24px 24px 48px; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); gap: 16px; }
            .stat-number { font-size: 24px; }
            .section { padding: 20px 24px; }
            .modal { padding: 16px; align-items: flex-start; padding-top: max(16px, env(safe-area-inset-top)); }
            .modal-content { max-height: calc(90vh - env(safe-area-inset-top) - env(safe-area-inset-bottom)); }
            .copy-toast { bottom: max(24px, env(safe-area-inset-bottom)); }
        }
        .login-screen { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #0f172a; display: flex; align-items: center; justify-content: center; z-index: 10000; }
        .login-screen.hidden { display: none; }
        .login-box { background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 32px; width: 100%; max-width: 380px; box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
        .login-box h2 { font-size: 18px; font-weight: 600; color: #f1f5f9; margin: 0 0 24px 0; text-align: center; }
        .login-box .form-group { margin-bottom: 16px; }
        .login-box .form-group label { display: block; font-size: 12px; font-weight: 500; color: #94a3b8; margin-bottom: 6px; }
        .login-box input { width: 100%; padding: 10px 14px; background: #0f172a; border: 1px solid #475569; border-radius: 8px; color: #f1f5f9; font-size: 14px; box-sizing: border-box; }
        .login-box input:focus { border-color: #6366f1; outline: none; }
        .login-box .btn-login { width: 100%; padding: 12px; font-size: 14px; font-weight: 600; background: #6366f1; color: #fff; border: none; border-radius: 8px; cursor: pointer; margin-top: 8px; }
        .login-box .btn-login:hover { background: #4f46e5; }
        .login-box .login-error { color: #fca5a5; font-size: 13px; margin-top: 12px; display: none; }
        .login-box .login-error.show { display: block; }
        .admin-panel-wrap { display: none; width: 100%; flex: 1; flex-direction: column; overflow: hidden; }
        .admin-panel-wrap.visible { display: flex; }
        .admin-tabs { display: flex; gap: 0; border-bottom: 1px solid #334155; padding: 0 40px; background: #1e293b; }
        .admin-tabs .tab { padding: 12px 20px; font-size: 14px; font-weight: 500; color: #94a3b8; background: none; border: none; cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -1px; }
        .admin-tabs .tab:hover { color: #e2e8f0; }
        .admin-tabs .tab.active { color: #6366f1; border-bottom-color: #6366f1; }
        .admin-tabs .tab.hidden { display: none; }
    </style>
</head>

<body class="admin-page">
    <div id="login-screen" class="login-screen">
        <div class="login-box">
            <h2>Entrar no painel</h2>
            <form id="login-form">
                <div class="form-group">
                    <label for="login-email">E-mail</label>
                    <input type="email" id="login-email" required autocomplete="email" placeholder="seu@email.com">
                </div>
                <div class="form-group">
                    <label for="login-password">Senha</label>
                    <input type="password" id="login-password" required autocomplete="current-password" placeholder="••••••••">
                </div>
                <p id="login-error" class="login-error" aria-live="polite"></p>
                <button type="submit" class="btn btn-login" id="btn-login-submit">Entrar</button>
            </form>
        </div>
    </div>

    <div id="admin-panel-wrap" class="admin-panel-wrap">
    <header class="admin-topbar">
        <div>
            <h1>Painel de Administração</h1>
            <p class="admin-topbar-desc">Lovable Infinity – Gerenciamento de Licenças</p>
        </div>
        <nav class="admin-tabs" aria-label="Abas do painel">
            <button type="button" class="tab active" id="tab-licenses" data-tab="licenses">Licenças</button>
            <button type="button" class="tab hidden" id="tab-admin" data-tab="admin">Administração</button>
        </nav>
        <div style="display: flex; align-items: center; gap: 12px;">
            <button type="button" class="btn-cta" id="btn-open-create-modal">Criar licença</button>
            <button type="button" class="btn btn-secondary" id="btn-logout">Sair</button>
        </div>
    </header>

    <main class="admin-main" id="main-licenses">
        <div id="alert-main" class="alert" aria-live="polite"></div>
        <div id="copy-toast" class="copy-toast" aria-live="polite">Copiado!</div>

        <div class="stats-grid" id="stats-grid"></div>

        <div class="section">
            <div class="admin-table-wrap">
                <table class="license-table">
                    <thead>
                        <tr>
                            <th>Chave</th>
                            <th>Nome</th>
                            <th>Telefone</th>
                            <th>Status</th>
                            <th>Ativada</th>
                            <th>Expiração</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="licenses-tbody"></tbody>
                </table>
            </div>
        </div>

        <div class="section">
            <button type="button" class="btn btn-secondary import-export-toggle" id="btn-toggle-import-export" aria-expanded="false">Importar / Exportar</button>
            <div class="import-export-body" id="import-export-body">
                <div class="form-group">
                    <label>Exportar Licenças (JSON)</label>
                    <textarea id="export-textarea" readonly rows="4" style="resize: vertical;"></textarea>
                </div>
                <div class="button-group">
                    <button type="button" class="btn btn-secondary" id="btn-export">Exportar</button>
                    <button type="button" class="btn btn-secondary" id="btn-copy-export">Copiar JSON</button>
                </div>
                <div class="form-group" style="margin-top: 16px;">
                    <label>Importar Licenças (JSON)</label>
                    <textarea id="import-textarea" placeholder="Cole o JSON aqui..." rows="4" style="resize: vertical;"></textarea>
                </div>
                <button type="button" class="btn btn-primary" id="btn-import">Importar</button>
            </div>
        </div>
    </main>

    <main class="admin-main" id="main-admin" style="display: none;" aria-hidden="true">
        <div class="section">
            <h2>Criar acesso ao painel</h2>
            <p style="color: #94a3b8; margin-bottom: 20px;">Cadastre um usuário para acessar o painel com e-mail e senha. Cada usuário terá seu próprio ambiente de licenças.</p>
            <div class="form-group">
                <label for="panel-user-email">E-mail do novo usuário</label>
                <input type="email" id="panel-user-email" placeholder="email@exemplo.com" autocomplete="off">
            </div>
            <div class="form-group">
                <label for="panel-user-password">Senha</label>
                <input type="password" id="panel-user-password" placeholder="Mínimo 6 caracteres" autocomplete="new-password">
            </div>
            <div class="form-group">
                <label for="panel-user-password-confirm">Confirmar senha</label>
                <input type="password" id="panel-user-password-confirm" placeholder="Repita a senha" autocomplete="new-password">
            </div>
            <p id="panel-user-error" class="alert alert-error" style="display: none;"></p>
            <div class="button-group">
                <button type="button" class="btn btn-primary" id="btn-create-panel-user">Gerar acesso</button>
            </div>
        </div>
    </main>

    </div>

    <!-- Modal Criar licença -->
    <div id="modal-create" class="modal" role="dialog" aria-labelledby="modal-create-title">
        <div class="modal-content">
            <button type="button" class="modal-close" id="modal-create-close" aria-label="Fechar">×</button>
            <h2 class="modal-header" id="modal-create-title">Criar licença</h2>
            <div class="form-group">
                <label>Nome do usuário</label>
                <input type="text" id="create-user-name" placeholder="Ex: João Silva">
            </div>
            <div class="form-group">
                <label>Telefone do usuário</label>
                <input type="tel" id="create-user-phone" placeholder="Ex: (11) 99999-9999">
            </div>
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="create-license-lifetime">
                    <span>Licença vitalícia</span>
                </label>
            </div>
            <div class="form-group" id="create-expiry-days-group">
                <label>Dias de validade</label>
                <input type="number" id="create-expiry-days" value="30" min="1" max="365">
            </div>
            <div class="form-group">
                <label>Limite de usos (vazio = ilimitado)</label>
                <input type="number" id="create-max-uses" placeholder="Ex: 100">
            </div>
            <div class="button-group">
                <button type="button" class="btn btn-primary" id="btn-create-submit">Gerar licença</button>
                <button type="button" class="btn btn-secondary" id="btn-create-cancel">Cancelar</button>
            </div>
            <div id="create-result" style="display: none; margin-top: 20px;">
                <div class="form-group">
                    <label>Licença gerada</label>
                    <div class="license-key" id="create-new-license-key"></div>
                </div>
                <button type="button" class="btn btn-secondary" id="btn-create-copy">Copiar</button>
            </div>
        </div>
    </div>

    <!-- Modal Editar licença -->
    <div id="modal-edit" class="modal" role="dialog" aria-labelledby="modal-edit-title">
        <div class="modal-content modal-edit">
            <button type="button" class="modal-close" id="modal-edit-close" aria-label="Fechar">×</button>
            <h2 class="modal-header" id="modal-edit-title">Editar licença</h2>
            <input type="hidden" id="edit-license-key" value="">
            <div class="form-group">
                <label>Chave (somente leitura)</label>
                <div class="license-key" id="edit-license-key-display"></div>
            </div>
            <div class="form-group">
                <label>Nome do usuário</label>
                <input type="text" id="edit-user-name" placeholder="Nome">
            </div>
            <div class="form-group">
                <label>Telefone do usuário</label>
                <input type="tel" id="edit-user-phone" placeholder="Telefone">
            </div>
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="edit-active">
                    <span>Licença ativa</span>
                </label>
            </div>
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="edit-lifetime">
                    <span>Licença vitalícia</span>
                </label>
            </div>
            <div class="form-group" id="edit-expiry-group">
                <label>Data de expiração</label>
                <input type="date" id="edit-expiry-date">
            </div>
            <div class="form-group">
                <label>Limite de usos (vazio = ilimitado)</label>
                <input type="number" id="edit-max-uses" placeholder="Ilimitado">
            </div>
            <div class="button-group">
                <button type="button" class="btn btn-primary" id="btn-edit-submit">Salvar</button>
                <button type="button" class="btn btn-secondary" id="btn-edit-cancel">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal de confirmação -->
    <div id="confirm-modal" class="modal">
        <div class="modal-content">
            <button type="button" class="modal-close" id="modal-close" aria-label="Fechar">×</button>
            <div class="modal-header" id="modal-title"></div>
            <p id="modal-message"></p>
            <div class="button-group">
                <button type="button" class="btn btn-primary" id="btn-confirm">Confirmar</button>
                <button type="button" class="btn btn-secondary" id="btn-cancel">Cancelar</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script src="license-manager.js"></script>
    <script src="admin.js"></script>
</body>

</html>
